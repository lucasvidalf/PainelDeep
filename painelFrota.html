<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Dashboard — Disponibilidade de Empilhadeiras</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#e8fffb; --paper:#fff; --tile:#f7fbfa;
    --brand:#0b4c59; --brand-2:#3db7ac; --ink:#0b1f1e;
    --muted:#6a7a79; --line:#dbe7e5;
    --chip:#edf7f6; --chip-line:rgba(61,183,172,.25);
    --shadow:0 8px 24px rgba(0,0,0,.08);
    --br-lg:16px; --br-md:12px; --br-sm:10px;

    /* pílulas de placa iguais em todos os blocos */
    --placa-w: 110px;
    --placa-pad: 8px 14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    padding: clamp(14px, 2.4vw, 28px);
  }

  /* header do dashboard */
  .app-head{
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; flex-wrap:wrap; margin:0 0 16px;
  }
  .app-head h1{
    margin:0; font-weight:900; color:var(--brand);
    font-size: clamp(22px,3.2vw,36px);
  }
  .last-update{
    font-weight:900; color:#064a44; font-size:13px;
    background:#d8f2ee; padding:8px 14px; border-radius:999px;
    box-shadow:0 0 0 2px rgba(61,183,172,.22) inset;
  }

  /* grid: 2 painéis por linha */
  .grid{
    display:grid; gap:18px;
    grid-template-columns: repeat(12, 1fr);
    width:100%;
  }
  .col-6{ grid-column: span 6; }
  @media (max-width:960px){ .col-6{ grid-column: span 12; } }

  /* painel */
  .panel{
    background:var(--paper); border:1px solid #d9efec; border-radius:var(--br-lg);
    box-shadow:var(--shadow); overflow:visible; display:flex; flex-direction:column;
  }
  .panel::before{ content:""; display:block; height:14px; background:var(--brand-2) }

  /* header do painel */
  .ph{
    display:grid; grid-template-columns: auto 1fr auto; gap:12px;
    align-items:center; padding:14px 14px 6px;
  }
  .ph .title{ margin:0; font-weight:900; font-size: clamp(18px,2.2vw,22px) }
  .ph .status{ font-size:22px }
  .ph .stamp{
    justify-self:end; font-size:12px; font-weight:900; color:#064a44;
    background:#d8f2ee; padding:6px 10px; border-radius:999px;
    box-shadow:0 0 0 2px rgba(61,183,172,.22) inset;
  }

  /* chips + legenda */
  .subhead{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:0 14px 10px;
  }
  .chips{ display:flex; gap:10px; flex-wrap:wrap }
  .chip{
    display:inline-flex; align-items:center; gap:8px; white-space:nowrap;
    background:var(--chip); padding:6px 10px; border-radius:999px; font-weight:800; color:#063a36; font-size:13px;
    box-shadow:0 0 0 1px var(--chip-line) inset;
  }
  .chip .dot{ width:10px; height:10px; border-radius:50% }
  .dot-disp{ background:#22a06b } .dot-manu{ background:#9aa4a3 }

  .legend{ display:flex; gap:14px; font-size:12px; font-weight:800; color:#475; flex-wrap:wrap }
  .sw{ width:14px; height:14px; border-radius:4px; display:inline-block; margin-right:5px }
  .sw-corr{ background:#f3c1bd; border:1px solid #d9b0ac }
  .sw-prev{ background:#f6e4b4; border:1px solid #d4c28c }

  .section{ padding:0 14px 12px; display:flex; flex-direction:column; gap:14px }

  /* dois cartões lado a lado (andar superior e inferior) */
  .pair{
    display:grid; grid-template-columns: 1fr 1fr; gap:14px;
    align-items:stretch;
  }
  @media (max-width:760px){ .pair{ grid-template-columns: 1fr; } }

  .card{
    background:var(--tile); border:1px solid var(--line); border-radius:14px;
    padding:12px; display:flex; flex-direction:column; height:100%;
  }
  .card h3{
    margin:0 0 8px; font-size:15px; font-weight:900; color:var(--brand);
    display:flex; align-items:center; gap:10px;
  }

  /* listas 3-colunas padronizadas (Placa | Info1 | Info2) */
  .list-3col{ list-style:none; margin:0; padding:0; flex:1 }
  .list-3col .li{
    display:grid;
    grid-template-columns: var(--placa-w) 1fr 84px;
    gap:12px;
    align-items:center;
    padding:10px 0;
    border-top:1px dashed #d9e6e3;
    text-align: center;
  }
  .list-3col .li:first-child{ border-top:0 }
  .list-3col .li.head{
    font-size:12px; font-weight:800; color:#344;
    text-transform:uppercase; letter-spacing:.4px;
    padding:8px 10px; margin-bottom:6px;
    border:1px solid #dbe7e5; border-radius:10px; background:#e9f4f1; text-align:center
  }
  .list-3col .li.head span:last-child{ text-align:center }
  .list-3col .num{ text-align:center; font-weight:800 }
  .list-3col .muted{ color:var(--muted) }
  .motivo{ text-align:center }

  /* pílula de PLACA */
  .placa{
    width: var(--placa-w);
    font-family: inherit;
    font-weight: 900;
    font-size: 14px;
    letter-spacing: .3px;
    display:inline-block;
    padding: var(--placa-pad);
    text-align:center;
    border-radius:12px;
    color:#0b5660;
    background:#d8f2ee;
    box-shadow:0 0 0 2px rgba(61,183,172,.18) inset;
    margin-left:12px;
  }
  /* cores para manutenção */
  .placa.corr{ background:#f3c1bd; color:#7b1d18; box-shadow:0 0 0 2px rgba(192,57,43,.25) inset; }
  .placa.prev{ background:#f6e4b4; color:#7a5c00; box-shadow:0 0 0 2px rgba(212,163,58,.25) inset; }

  .eta{ font-size:12px; color:var(--muted); text-align:right }

  /* rodapé resumo */
  .foot{ text-align:right; font-size:12px; font-weight:800; color:#475; }
</style>
</head>
<body>
  <div class="app-head">
    <h1>Dashboard — Disponibilidade de Empilhadeiras</h1>
    <div class="last-update" id="lastUpdate">Última atualização: —</div>
  </div>

  <main id="grid" class="grid"></main>

<script>
/* ========= DADOS MOCK ========= */
const DATA = {
  sites:[
    {
      nome:"Lençóis Paulista",
      updated:"2025-08-29T06:45:12Z",
      grupos:[
        {
          cap:"7t",
          disponiveis:[
            {placa:"LPL-101",capacidade:"07 ton",contrato:"Celulose"},
            {placa:"LPL-234",capacidade:"07 ton",contrato:"Celulose"},
            {placa:"LPL-307",capacidade:"07 ton",contrato:"Celulose"}
          ],
          manut:[
            {placa:"LPL-553",tipo:"preventiva",motivo:"Elétrica",etaISO:"2025-08-30T00:00:00Z"},
            {placa:"LPL-775",tipo:"corretiva",motivo:"Elétrica",etaISO:"2025-08-30T00:00:00Z"}
          ]
        }
      ],
      top:{corretivas:[{placa:"LPL-775",os:4},{placa:"LPL-553",os:1}],
           paradas:[{placa:"LPL-775",horas:117},{placa:"LPL-553",horas:43}]}
    },
    {
      nome:"Pederneiras",
      updated:"2025-08-29T07:05:00Z",
      grupos:[
        { cap:"7t",  disponiveis:[{placa:"PDN-701"},{placa:"PDN-702"}], manut:[] },
        { cap:"16t", disponiveis:[], manut:[
          {placa:"PDN-1602",tipo:"corretiva",motivo:"Transmissão",etaISO:"2025-08-30T18:00:00Z"}
        ] }
      ],
      top:{corretivas:[{placa:"PDN-1602",os:5}],
           paradas:[{placa:"PDN-1602",horas:92}]}
    },
    {
      nome:"Santos",
      updated:"2025-08-29T10:40:00Z",
      grupos:[
        { cap:"7t", disponiveis:[{placa:"STS-701"},{placa:"STS-703"}], manut:[
          {placa:"STS-702",tipo:"corretiva",motivo:"Freio",etaISO:"2025-08-29T22:00:00Z"}
        ]},
        { cap:"8t (ELE)", disponiveis:[{placa:"STS-801"}], manut:[] }
      ],
      top:{corretivas:[{placa:"STS-702",os:2}], paradas:[{placa:"STS-702",horas:24}]}
    },
      {
      nome:"Rio de Janeiro",
      updated:"2025-08-29T07:20:00Z",
      grupos:[
        { cap:"3,5t", disponiveis:[{placa:"RIO-035-1"}], manut:[] },
        { cap:"7t",   disponiveis:[{placa:"RIO-070-1"}], manut:[] }
      ],
      top:{corretivas:[], paradas:[]}
    },
    {
      nome:"Itajaí",
      updated:"2025-08-29T08:15:00Z",
      grupos:[
        { cap:"2,5t", disponiveis:[{placa:"ITJ-025-1"},{placa:"ITJ-025-2"}], manut:[] },
        { cap:"4,5t", disponiveis:[], manut:[
          {placa:"ITJ-045-1",tipo:"corretiva",motivo:"Mastro",etaISO:"2025-08-31T16:00:00Z"}
        ] }
      ],
      top:{corretivas:[{placa:"ITJ-045-1",os:3}], paradas:[{placa:"ITJ-045-1",horas:55}]}
    },
    {
      nome:"Itapoá",
      updated:"2025-08-29T09:05:00Z",
      grupos:[
        { cap:"2,5t", disponiveis:[{placa:"ITP-025-1"},{placa:"ITP-025-2"}], manut:[] },
        { cap:"45t",  disponiveis:[], manut:[
          {placa:"ITP-450-1",tipo:"corretiva",motivo:"Sistema de vácuo",etaISO:"2025-08-30T20:00:00Z"}
        ] }
      ],
      top:{corretivas:[{placa:"ITP-450-1",os:1}], paradas:[{placa:"ITP-450-1",horas:70}]}
    },  
  ]
};

/* =================== Helpers =================== */
const fmtDateShort = iso => {
  const d=new Date(iso); if(isNaN(+d)) return "—";
  return d.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"});
};
const fmtDateShortTime = iso => {
  const d=new Date(iso); if(isNaN(+d)) return "—";
  return d.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});
};
const fmtDateFull = iso => {
  const d=new Date(iso); if(isNaN(+d)) return "—";
  return d.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});
};

/* Normaliza “disponiveis”: aceita string ou objeto */
function flattenDisponiveis(site){
  return site.grupos.flatMap(g =>
    (g.disponiveis || []).map(p => (typeof p === 'string' ? {placa:p} : p))
  );
}
function flattenManutencoes(site){
  return site.grupos.flatMap(g => g.manut.map(m => ({...m})));
}
function counters(site){
  const disp = flattenDisponiveis(site).length;
  const man  = flattenManutencoes(site).length;
  const corr = flattenManutencoes(site).filter(m=>m.tipo==='corretiva').length;
  const prev = man - corr;
  return {disp,man,corr,prev};
}
function statusIcon({disp,man,corr}){
  const total=disp+man; if(total===0) return "⚪";
  const r=disp/total;
  if(disp===0 || r<0.40) return "‼️";
  if(r<0.70 || corr>0)   return "⚠️";
  return "✅";
}
const chip = (t,cls) => `<span class="chip"><span class="dot ${cls}"></span>${t}</span>`;

/* =================== Render =================== */
const grid = document.getElementById('grid');

function renderPanel(site){
  const cnt = counters(site);
  const dispList = flattenDisponiveis(site);
  const manList  = flattenManutencoes(site);

  const header = `
    <div class="ph">
      <h2 class="title">${site.nome}</h2>
      <div class="status" title="Status">${statusIcon(cnt)}</div>
      <div class="stamp">Atualizado em ${fmtDateShortTime(site.updated)}</div>
    </div>
    <div class="subhead">
      <div class="chips">
        ${chip(`Disp.: ${cnt.disp}`,'dot-disp')}
        ${chip(`Manut.: ${cnt.man}`,'dot-manu')}
      </div>
      <div class="legend">
        <span><span class="sw sw-corr"></span> Corretiva</span>
        <span><span class="sw sw-prev"></span> Preventiva</span>
      </div>
    </div>
  `;

  /* ---------- SUPERIOR (Disponíveis | Em manutenção) ---------- */
  const upper = `
    <div class="pair block-upper">
      <!-- Placas disponíveis -->
      <div class="card">
        <h3>Placas disponíveis</h3>
        <ul class="list-3col">
          <li class="li head"><span>Placa</span><span>Capacidade</span><span>Contrato</span></li>
          ${
            dispList.length
              ? dispList.map(r=>`
                  <li class="li">
                    <span class="placa">${r.placa}</span>
                    <span>${r.capacidade||'-'}</span>
                    <span>${r.contrato||'-'}</span>
                  </li>
                `).join('')
              : `<li class="li"><span class="muted" style="grid-column:1/4;margin-left:12px">— nenhuma placa disponível</span></li>`
          }
        </ul>
      </div>

      <!-- Em manutenção (Placa | Motivo | Previsão) -->
      <div class="card">
        <h3>Em manutenção</h3>
        <ul class="list-3col">
          <li class="li head"><span>Placa</span><span>Motivo</span><span>Previsão</span></li>
          ${
            manList.length
              ? manList.map(m=>`
                  <li class="li">
                    <span class="placa ${m.tipo==='corretiva'?'corr':'prev'}">${m.placa}</span>
                    <span class="motivo">${m.motivo||'—'}</span>
                    <span class="num">${fmtDateShort(m.etaISO)}</span>
                  </li>
                `).join('')
              : `<li class="li"><span class="muted" style="grid-column:1/4;margin-left:12px">— sem manutenção no momento</span></li>`
          }
        </ul>
      </div>
    </div>
  `;

  /* ---------- INFERIOR (Top 5 OS | Top 5 Parada) ---------- */
  const lower = `
    <div class="pair block-lower">
      <!-- Top 5 — OS Corretivas -->
      <div class="card">
        <h3>Top 5 — OS Corretivas <span class="placa" style="background:#e9f4f1;color:#123;min-width:auto;padding:4px 8px">mês</span></h3>
        <ul class="list-3col">
          <li class="li head"><span>Placa</span><span></span><span>#OS</span></li>
          ${
            (site.top?.corretivas||[]).slice(0,5).map(r=>`
              <li class="li">
                <span class="placa">${r.placa}</span>
                <span></span>
                <span class="num">${r.os}</span>
              </li>
            `).join('') || `<li class="li"><span class="muted" style="grid-column:1/4;margin-left:12px">— sem dados</span></li>`
          }
        </ul>
      </div>

      <!-- Top 5 — Tempo de Parada -->
      <div class="card">
        <h3>Top 5 — Tempo de Parada <span class="placa" style="background:#e9f4f1;color:#123;min-width:auto;padding:4px 8px">mês</span></h3>
        <ul class="list-3col">
          <li class="li head"><span>Placa</span><span></span><span>Horas</span></li>
          ${
            (site.top?.paradas||[]).slice(0,5).map(r=>`
              <li class="li">
                <span class="placa">${r.placa}</span>
                <span></span>
                <span class="num">${r.horas}</span>
              </li>
            `).join('') || `<li class="li"><span class="muted" style="grid-column:1/4;margin-left:12px">— sem dados</span></li>`
          }
        </ul>
      </div>
    </div>
  `;

  const foot = `<div class="foot">Corretivas: ${cnt.corr} &nbsp; Preventivas: ${cnt.prev}</div>`;

  return `<section class="panel col-6">${header}<div class="section">${upper}${lower}${foot}</div></section>`;
}

function renderDashboard(data){
  // topo: última atualização global (maior timestamp)
  const maxTs = data.sites.reduce((max,s)=> Math.max(max, +new Date(s.updated)), 0);
  document.getElementById('lastUpdate').textContent = "Última atualização: " + fmtDateFull(maxTs);

  // render
  grid.innerHTML = data.sites.map(renderPanel).join('');

  // equaliza alturas dos blocos superior e inferior em cada linha (desktop)
  syncHeights();
}

function syncHeights(){
  const isMobile = matchMedia("(max-width: 960px)").matches;
  const items = Array.from(document.querySelectorAll(".panel"));
  // limpa
  document.querySelectorAll(".block-upper,.block-lower").forEach(b=> b.style.height="auto");
  if (isMobile) return;

  // agrupa de 2 em 2 (mesma linha)
  for (let i=0; i<items.length; i+=2){
    const a = items[i], b = items[i+1]; if(!b) break;
    const au = a.querySelector(".block-upper"), bu = b.querySelector(".block-upper");
    const al = a.querySelector(".block-lower"), bl = b.querySelector(".block-lower");
    const hU = Math.max(au.offsetHeight, bu.offsetHeight);
    const hL = Math.max(al.offsetHeight, bl.offsetHeight);
    au.style.height = bu.style.height = hU + "px";
    al.style.height = bl.style.height = hL + "px";
  }
}

window.addEventListener('resize', () => {
  clearTimeout(window.__rh);
  window.__rh = setTimeout(syncHeights, 100);
});

/* boot */
renderDashboard(DATA);

/* ===== Conectando ao GAS depois =====
fetch(SCRIPT_URL)
  .then(r=>r.json())
  .then(payload => renderDashboard(payload))
  .catch(console.error);
*/
</script>
</body>
</html>
